<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBTI è‡ªåª’ä½“å†…å®¹ç”Ÿæˆå™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0d14;
    --surface: #16161f;
    --surface2: #1e1e2a;
    --border: rgba(255,255,255,0.07);
    --gold: #e8c96a;
    --gold-dim: rgba(232,201,106,0.15);
    --rose: #e88fa0;
    --rose-dim: rgba(232,143,160,0.12);
    --sage: #7eb8a4;
    --text: #e8e6f0;
    --text-dim: #7a7890;
    --accent: #9f7aea;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans SC', sans-serif;
    min-height: 100vh;
    padding: 0;
    overflow-x: hidden;
  }

  /* Background grain */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.4;
  }

  .glow-orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
    z-index: 0;
  }
  .orb1 { width: 400px; height: 400px; background: rgba(159,122,234,0.08); top: -100px; right: -100px; }
  .orb2 { width: 300px; height: 300px; background: rgba(232,201,106,0.06); bottom: 0; left: -50px; }

  .app {
    position: relative;
    z-index: 1;
    max-width: 1100px;
    margin: 0 auto;
    padding: 40px 24px;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 48px;
    animation: fadeDown 0.7s ease both;
  }

  .header-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--gold-dim);
    border: 1px solid rgba(232,201,106,0.25);
    color: var(--gold);
    font-size: 0.72rem;
    padding: 4px 14px;
    border-radius: 100px;
    letter-spacing: 0.12em;
    margin-bottom: 16px;
    font-weight: 500;
  }

  .header h1 {
    font-family: 'Noto Serif SC', serif;
    font-size: 2.2rem;
    font-weight: 700;
    background: linear-gradient(135deg, #ffffff 0%, var(--gold) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 0.05em;
    margin-bottom: 10px;
  }

  .header p {
    color: var(--text-dim);
    font-size: 0.85rem;
    letter-spacing: 0.05em;
  }

  /* Main layout */
  .main-grid {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: 24px;
    align-items: start;
  }

  @media (max-width: 850px) {
    .main-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 1.6rem; }
  }

  /* Panel */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 24px;
    animation: fadeUp 0.7s 0.1s ease both;
  }

  .panel-title {
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 0.12em;
    font-weight: 500;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .panel-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Form elements */
  .field { margin-bottom: 18px; }

  label {
    display: block;
    font-size: 0.78rem;
    color: var(--text-dim);
    margin-bottom: 7px;
    letter-spacing: 0.04em;
  }

  select, input[type="text"] {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.85rem;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
    appearance: none;
  }

  select:focus, input[type="text"]:focus {
    border-color: rgba(232,201,106,0.4);
  }

  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237a7890' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 32px;
    cursor: pointer;
  }

  select option { background: #1e1e2a; }

  /* Type selector pills */
  .type-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
    margin-bottom: 4px;
  }

  .type-pill {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 4px;
    text-align: center;
    font-size: 0.78rem;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-dim);
    font-weight: 500;
    letter-spacing: 0.02em;
  }

  .type-pill:hover { border-color: rgba(232,201,106,0.3); color: var(--gold); }
  .type-pill.selected { background: var(--gold-dim); border-color: rgba(232,201,106,0.5); color: var(--gold); }

  .type-pill-2 {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 4px;
    text-align: center;
    font-size: 0.78rem;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-dim);
    font-weight: 500;
  }
  .type-pill-2:hover { border-color: rgba(232,143,160,0.3); color: var(--rose); }
  .type-pill-2.selected { background: var(--rose-dim); border-color: rgba(232,143,160,0.5); color: var(--rose); }

  /* Content type toggle */
  .content-type-toggle {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 6px;
    margin-bottom: 18px;
  }

  .ct-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 6px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-dim);
    font-size: 0.75rem;
    font-family: 'Noto Sans SC', sans-serif;
  }

  .ct-btn .icon { font-size: 1.1rem; display: block; margin-bottom: 3px; }
  .ct-btn:hover { border-color: rgba(159,122,234,0.4); color: var(--accent); }
  .ct-btn.selected { background: rgba(159,122,234,0.12); border-color: rgba(159,122,234,0.5); color: var(--accent); }

  /* API Key field */
  .api-field {
    position: relative;
  }

  .api-field input {
    padding-right: 80px;
  }

  .api-toggle {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-dim);
    font-size: 0.72rem;
    cursor: pointer;
    font-family: 'Noto Sans SC', sans-serif;
    padding: 2px 6px;
  }

  /* Generate button */
  .gen-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--gold) 0%, #f5a623 100%);
    border: none;
    border-radius: 12px;
    padding: 14px;
    color: #1a1000;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.08em;
    transition: all 0.2s;
    margin-top: 8px;
    position: relative;
    overflow: hidden;
  }

  .gen-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(232,201,106,0.3); }
  .gen-btn:active { transform: translateY(0); }
  .gen-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .gen-btn .spinner {
    display: none;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(26,16,0,0.3);
    border-top-color: #1a1000;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto;
  }

  /* Output panel */
  .output-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    overflow: hidden;
    animation: fadeUp 0.7s 0.2s ease both;
    min-height: 500px;
    display: flex;
    flex-direction: column;
  }

  .output-header {
    padding: 18px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .output-tabs {
    display: flex;
    gap: 4px;
  }

  .out-tab {
    padding: 5px 14px;
    border-radius: 8px;
    font-size: 0.75rem;
    cursor: pointer;
    color: var(--text-dim);
    background: none;
    border: none;
    font-family: 'Noto Sans SC', sans-serif;
    transition: all 0.2s;
  }

  .out-tab.active { background: var(--surface2); color: var(--text); }

  .output-actions {
    display: flex;
    gap: 8px;
  }

  .action-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 5px 12px;
    font-size: 0.72rem;
    color: var(--text-dim);
    cursor: pointer;
    font-family: 'Noto Sans SC', sans-serif;
    transition: all 0.2s;
  }

  .action-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.15); }

  .output-body {
    flex: 1;
    padding: 28px;
    overflow-y: auto;
  }

  /* Empty state */
  .empty-state {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--text-dim);
    text-align: center;
    gap: 12px;
    padding: 60px 20px;
  }

  .empty-icon {
    font-size: 2.5rem;
    opacity: 0.4;
  }

  .empty-state p {
    font-size: 0.83rem;
    line-height: 1.7;
    max-width: 280px;
  }

  /* Generated content display */
  .content-display {
    display: none;
  }

  .content-display.active { display: block; }

  .post-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 16px;
    position: relative;
  }

  .post-platform {
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 0.68rem;
    background: var(--gold-dim);
    color: var(--gold);
    padding: 3px 10px;
    border-radius: 100px;
    border: 1px solid rgba(232,201,106,0.2);
  }

  .post-title {
    font-family: 'Noto Serif SC', serif;
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 14px;
    padding-right: 80px;
    line-height: 1.5;
  }

  .post-body {
    font-size: 0.86rem;
    line-height: 2;
    color: rgba(232,230,240,0.75);
    white-space: pre-wrap;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 16px;
  }

  .post-tag {
    font-size: 0.72rem;
    color: var(--rose);
    background: var(--rose-dim);
    padding: 3px 10px;
    border-radius: 100px;
  }

  /* Loading skeleton */
  .skeleton {
    background: linear-gradient(90deg, var(--surface2) 25%, rgba(255,255,255,0.03) 50%, var(--surface2) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 8px;
  }

  /* History list */
  .history-list {
    display: none;
  }

  .history-list.active { display: block; }

  .history-item {
    padding: 14px 16px;
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .history-item:hover { border-color: rgba(232,201,106,0.3); background: var(--surface2); }

  .history-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
  }

  .history-type {
    font-size: 0.72rem;
    color: var(--gold);
  }

  .history-time {
    font-size: 0.7rem;
    color: var(--text-dim);
  }

  .history-preview {
    font-size: 0.82rem;
    color: var(--text-dim);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Streaming text */
  .streaming-cursor::after {
    content: 'â–‹';
    animation: blink 0.7s infinite;
    color: var(--gold);
  }

  @keyframes fadeDown { from { opacity:0; transform:translateY(-16px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes shimmer { to { background-position: -200% 0; } }
  @keyframes blink { 0%,100% { opacity:1; } 50% { opacity:0; } }
</style>
</head>
<body>

<div class="glow-orb orb1"></div>
<div class="glow-orb orb2"></div>

<div class="app">
  <div class="header">
    <div class="header-badge">âœ¦ AI å†…å®¹ç”Ÿæˆç³»ç»Ÿ âœ¦</div>
    <h1>MBTI è‡ªåª’ä½“å†…å®¹ç”Ÿæˆå™¨</h1>
    <p>å°çº¢ä¹¦ Â· å…¬ä¼—å· Â· æ¯æ—¥æ‰¹é‡ç”Ÿäº§</p>
  </div>

  <div class="main-grid">
    <!-- Control Panel -->
    <div class="panel">
      <div class="panel-title">å†…å®¹è®¾ç½®</div>

      <!-- Content Type -->
      <div class="field">
        <label>å†…å®¹ç±»å‹</label>
        <div class="content-type-toggle">
          <div class="ct-btn selected" onclick="selectContentType(this, 'personality')" data-type="personality">
            <span class="icon">ğŸ§ </span>æ€§æ ¼åˆ†æ
          </div>
          <div class="ct-btn" onclick="selectContentType(this, 'couple')" data-type="couple">
            <span class="icon">ğŸ’˜</span>æƒ…ä¾£é…å¯¹
          </div>
          <div class="ct-btn" onclick="selectContentType(this, 'workplace')" data-type="workplace">
            <span class="icon">ğŸ’¼</span>èŒåœºè§£è¯»
          </div>
        </div>
      </div>

      <!-- MBTI Type 1 -->
      <div class="field">
        <label>ä¸»è§’ MBTI ç±»å‹</label>
        <div class="type-grid" id="typeGrid1">
          <div class="type-pill selected" onclick="selectType(this, 1)" data-val="INFJ">INFJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="INFP">INFP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="INTJ">INTJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="INTP">INTP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ENFJ">ENFJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ENFP">ENFP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ENTJ">ENTJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ENTP">ENTP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ISFJ">ISFJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ISFP">ISFP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ISTJ">ISTJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ISTP">ISTP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ESFJ">ESFJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ESFP">ESFP</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ESTJ">ESTJ</div>
          <div class="type-pill" onclick="selectType(this, 1)" data-val="ESTP">ESTP</div>
        </div>
      </div>

      <!-- MBTI Type 2 (for couple/workplace) -->
      <div class="field" id="type2Field" style="display:none">
        <label>å¯¹è±¡ MBTI ç±»å‹</label>
        <div class="type-grid" id="typeGrid2">
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="INFJ">INFJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="INFP">INFP</div>
          <div class="type-pill-2 selected" onclick="selectType(this, 2)" data-val="INTJ">INTJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="INTP">INTP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ENFJ">ENFJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ENFP">ENFP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ENTJ">ENTJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ENTP">ENTP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ISFJ">ISFJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ISFP">ISFP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ISTJ">ISTJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ISTP">ISTP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ESFJ">ESFJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ESFP">ESFP</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ESTJ">ESTJ</div>
          <div class="type-pill-2" onclick="selectType(this, 2)" data-val="ESTP">ESTP</div>
        </div>
      </div>

      <!-- Platform -->
      <div class="field">
        <label>å‘å¸ƒå¹³å°</label>
        <select id="platform">
          <option value="xhs">å°çº¢ä¹¦</option>
          <option value="wechat">å¾®ä¿¡å…¬ä¼—å·</option>
          <option value="both">ä¸¤ä¸ªéƒ½è¦</option>
        </select>
      </div>

      <!-- Tone -->
      <div class="field">
        <label>å†…å®¹é£æ ¼</label>
        <select id="tone">
          <option value="emotional">æƒ…æ„Ÿå…±é¸£å‹ï¼ˆæˆ³å¿ƒçªï¼‰</option>
          <option value="analytical">æ·±åº¦åˆ†æå‹ï¼ˆæœ‰æ–™æœ‰æ®ï¼‰</option>
          <option value="humorous">å¹½é»˜è½»æ¾å‹ï¼ˆåå·®ç¬‘ç‚¹ï¼‰</option>
          <option value="story">æ•…äº‹å™è¿°å‹ï¼ˆä»£å…¥æ„Ÿå¼ºï¼‰</option>
        </select>
      </div>

      <!-- Extra angle -->
      <div class="field">
        <label>ç‰¹æ®Šè§’åº¦ï¼ˆå¯é€‰ï¼‰</label>
        <input type="text" id="angle" placeholder="ä¾‹ï¼šè¢«è¯¯è§£çš„ä¸€é¢ã€æ‹çˆ±ä¸­çš„æ‰§å¿µâ€¦">
      </div>

      <!-- API Key -->
      <div class="field">
        <label>Anthropic API Key</label>
        <div class="api-field">
          <input type="password" id="apiKey" placeholder="sk-ant-...">
          <button class="api-toggle" onclick="toggleApiKey()">æ˜¾ç¤º</button>
        </div>
      </div>

      <button class="gen-btn" id="genBtn" onclick="generate()">
        <span id="btnText">âœ¦ ç”Ÿæˆå†…å®¹</span>
        <div class="spinner" id="spinner"></div>
      </button>
    </div>

    <!-- Output Panel -->
    <div class="output-panel">
      <div class="output-header">
        <div class="output-tabs">
          <button class="out-tab active" onclick="switchTab(this, 'result')">ç”Ÿæˆç»“æœ</button>
          <button class="out-tab" onclick="switchTab(this, 'history')">å†å²è®°å½•</button>
        </div>
        <div class="output-actions">
          <button class="action-btn" onclick="copyAll()">å¤åˆ¶å…¨éƒ¨</button>
          <button class="action-btn" onclick="clearOutput()">æ¸…ç©º</button>
        </div>
      </div>
      <div class="output-body">

        <!-- Result tab -->
        <div class="content-display active" id="resultTab">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">âœ¦</div>
            <p>é€‰æ‹© MBTI ç±»å‹å’Œå†…å®¹é£æ ¼<br>ç‚¹å‡»ã€Œç”Ÿæˆå†…å®¹ã€å¼€å§‹åˆ›ä½œ</p>
          </div>
          <div id="generatedContent"></div>
        </div>

        <!-- History tab -->
        <div class="history-list" id="historyTab">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <p>æš‚æ— å†å²è®°å½•</p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  let selectedType1 = 'INFJ';
  let selectedType2 = 'INTJ';
  let selectedContentType = 'personality';
  let history = [];
  let apiKeyVisible = false;

  function selectType(el, num) {
    const grid = document.getElementById(`typeGrid${num}`);
    grid.querySelectorAll(num === 1 ? '.type-pill' : '.type-pill-2').forEach(p => p.classList.remove('selected'));
    el.classList.add('selected');
    if (num === 1) selectedType1 = el.dataset.val;
    else selectedType2 = el.dataset.val;
  }

  function selectContentType(el, type) {
    document.querySelectorAll('.ct-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
    selectedContentType = type;
    document.getElementById('type2Field').style.display = (type === 'personality') ? 'none' : 'block';
  }

  function toggleApiKey() {
    const input = document.getElementById('apiKey');
    apiKeyVisible = !apiKeyVisible;
    input.type = apiKeyVisible ? 'text' : 'password';
    document.querySelector('.api-toggle').textContent = apiKeyVisible ? 'éšè—' : 'æ˜¾ç¤º';
  }

  function switchTab(el, tab) {
    document.querySelectorAll('.out-tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('resultTab').classList.toggle('active', tab === 'result');
    document.getElementById('historyTab').classList.toggle('active', tab === 'history');
    document.getElementById('resultTab').style.display = tab === 'result' ? 'block' : 'none';
    document.getElementById('historyTab').style.display = tab === 'history' ? 'block' : 'none';
  }

  function buildPrompt() {
    const platform = document.getElementById('platform').value;
    const tone = document.getElementById('tone').value;
    const angle = document.getElementById('angle').value;

    const toneMap = {
      emotional: 'æƒ…æ„Ÿå…±é¸£å‹ï¼Œè¯­æ°”äº²åˆ‡æˆ³å¿ƒï¼Œå¼•å‘å¼ºçƒˆå…±é¸£',
      analytical: 'æ·±åº¦åˆ†æå‹ï¼Œæœ‰æ•°æ®æœ‰é€»è¾‘ï¼Œä¸“ä¸šæƒå¨',
      humorous: 'å¹½é»˜è½»æ¾å‹ï¼Œæœ‰åå·®æœ‰ç¬‘ç‚¹ï¼Œæ¥åœ°æ°”',
      story: 'æ•…äº‹å™è¿°å‹ï¼Œç”¨åœºæ™¯å’Œå¯¹è¯å¸¦å…¥ï¼Œä»£å…¥æ„Ÿå¼º'
    };

    const platformMap = {
      xhs: 'å°çº¢ä¹¦ï¼ˆçŸ­å¹³å¿«ï¼Œemojiä¸°å¯Œï¼Œæ ‡é¢˜å…šï¼Œç»“å°¾å¼•å¯¼äº’åŠ¨ï¼‰',
      wechat: 'å¾®ä¿¡å…¬ä¼—å·ï¼ˆå¯è¾ƒé•¿ï¼Œæœ‰æ·±åº¦ï¼Œåˆ†æ®µæ¸…æ™°ï¼‰',
      both: 'å°çº¢ä¹¦ç‰ˆæœ¬å’Œå…¬ä¼—å·ç‰ˆæœ¬å„ä¸€ç¯‡'
    };

    let typeDesc = '';
    if (selectedContentType === 'personality') {
      typeDesc = `ä¸»è§’ï¼š${selectedType1}`;
    } else if (selectedContentType === 'couple') {
      typeDesc = `æƒ…ä¾£ç»„åˆï¼š${selectedType1} Ã— ${selectedType2}`;
    } else {
      typeDesc = `èŒåœºæ­æ¡£/ä¸Šä¸‹çº§ï¼š${selectedType1} ä¸ ${selectedType2}`;
    }

    const contentTypeMap = {
      personality: 'MBTIæ€§æ ¼æ·±åº¦åˆ†æå¸–ï¼ŒæŒ–æ˜è¯¥ç±»å‹æœ€çœŸå®ã€æœ€å®¹æ˜“å¼•èµ·å…±é¸£çš„ç‰¹è´¨ã€ç—›ç‚¹å’Œé—ªå…‰ç‚¹',
      couple: 'MBTIæƒ…ä¾£é…å¯¹åˆ†æå¸–ï¼Œåˆ†æä¸¤ç§ç±»å‹åœ¨ä¸€èµ·çš„ç›¸å¤„æ¨¡å¼ã€çŸ›ç›¾ç‚¹å’Œç”œèœœç‚¹',
      workplace: 'MBTIèŒåœºå…³ç³»è§£è¯»å¸–ï¼Œåˆ†æè¿™ä¸¤ç§ç±»å‹åœ¨èŒåœºçš„åˆä½œæ–¹å¼ã€å†²çªå’Œäº’è¡¥'
    };

    return `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‡ªåª’ä½“å†…å®¹åˆ›ä½œè€…ï¼Œæ“…é•¿MBTIæ€§æ ¼åˆ†æå†…å®¹ã€‚

è¯·åˆ›ä½œä»¥ä¸‹å†…å®¹ï¼š
- å†…å®¹ç±»å‹ï¼š${contentTypeMap[selectedContentType]}
- MBTIç»„åˆï¼š${typeDesc}
- å‘å¸ƒå¹³å°ï¼š${platformMap[platform]}
- å†™ä½œé£æ ¼ï¼š${toneMap[tone]}
${angle ? `- ç‰¹æ®Šè§’åº¦/ä¸»é¢˜ï¼š${angle}` : ''}

è¦æ±‚ï¼š
1. æ ‡é¢˜è¦æœ‰å¸å¼•åŠ›ï¼Œè®©ç›®æ ‡ç”¨æˆ·ç«‹åˆ»æœ‰ç‚¹è¿›å»çš„å†²åŠ¨
2. å†…å®¹çœŸå®æœ‰å…±é¸£ï¼Œä¸è¦å‡å¤§ç©º
3. å°çº¢ä¹¦ç‰ˆæœ¬è¦æœ‰emojiï¼Œç»“å°¾è¦æœ‰äº’åŠ¨å¼•å¯¼å’Œè¯é¢˜æ ‡ç­¾ï¼ˆ5-8ä¸ªï¼‰
4. å…¬ä¼—å·ç‰ˆæœ¬å¯ä»¥æ›´æœ‰æ·±åº¦ï¼Œåˆ†æ®µæ¸…æ™°ï¼Œå¯ä»¥æœ‰å°æ ‡é¢˜
5. å­—æ•°ï¼šå°çº¢ä¹¦300-500å­—ï¼Œå…¬ä¼—å·500-800å­—

è¯·ç›´æ¥è¾“å‡ºå†…å®¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

ã€æ ‡é¢˜ã€‘
ï¼ˆæ ‡é¢˜å†…å®¹ï¼‰

ã€æ­£æ–‡ã€‘
ï¼ˆæ­£æ–‡å†…å®¹ï¼‰

ã€æ ‡ç­¾ã€‘ï¼ˆä»…å°çº¢ä¹¦éœ€è¦ï¼‰
ï¼ˆæ ‡ç­¾å†…å®¹ï¼‰`;
  }

  async function generate() {
    const apiKey = document.getElementById('apiKey').value.trim();
    if (!apiKey) {
      alert('è¯·å…ˆå¡«å†™ Anthropic API Key');
      return;
    }

    const btn = document.getElementById('genBtn');
    const btnText = document.getElementById('btnText');
    const spinner = document.getElementById('spinner');
    const emptyState = document.getElementById('emptyState');
    const generatedContent = document.getElementById('generatedContent');

    btn.disabled = true;
    btnText.style.display = 'none';
    spinner.style.display = 'block';
    emptyState.style.display = 'none';
    generatedContent.innerHTML = '';

    // Create loading card
    const loadingCard = document.createElement('div');
    loadingCard.className = 'post-card';
    loadingCard.innerHTML = `
      <div class="post-platform">ç”Ÿæˆä¸­â€¦</div>
      <div class="skeleton" style="height:20px;width:60%;margin-bottom:14px"></div>
      <div class="skeleton" style="height:14px;width:100%;margin-bottom:8px"></div>
      <div class="skeleton" style="height:14px;width:90%;margin-bottom:8px"></div>
      <div class="skeleton" style="height:14px;width:95%;margin-bottom:8px"></div>
      <div class="skeleton" style="height:14px;width:75%"></div>
    `;
    generatedContent.appendChild(loadingCard);

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-5-20250929',
          max_tokens: 2000,
          messages: [{ role: 'user', content: buildPrompt() }]
        })
      });

      const data = await response.json();

      if (data.error) {
        throw new Error(data.error.message);
      }

      const text = data.content[0].text;
      loadingCard.remove();
      renderContent(text);
      saveToHistory(text);

    } catch (err) {
      loadingCard.remove();
      generatedContent.innerHTML = `<div class="post-card" style="border-color:rgba(232,100,100,0.3)">
        <div style="color:#e88080;font-size:0.85rem">ç”Ÿæˆå¤±è´¥ï¼š${err.message}</div>
      </div>`;
    }

    btn.disabled = false;
    btnText.style.display = 'block';
    spinner.style.display = 'none';
  }

  function renderContent(text) {
    const generatedContent = document.getElementById('generatedContent');

    // Parse sections
    const titleMatch = text.match(/ã€æ ‡é¢˜ã€‘\n?([\s\S]*?)(?=ã€æ­£æ–‡ã€‘)/);
    const bodyMatch = text.match(/ã€æ­£æ–‡ã€‘\n?([\s\S]*?)(?=ã€æ ‡ç­¾ã€‘|$)/);
    const tagsMatch = text.match(/ã€æ ‡ç­¾ã€‘\n?([\s\S]*?)$/);

    const title = titleMatch ? titleMatch[1].trim() : '';
    const body = bodyMatch ? bodyMatch[1].trim() : text;
    const tagsRaw = tagsMatch ? tagsMatch[1].trim() : '';

    const platform = document.getElementById('platform').value;
    const platformLabel = { xhs: 'å°çº¢ä¹¦', wechat: 'å…¬ä¼—å·', both: 'å¤šå¹³å°' }[platform];

    const card = document.createElement('div');
    card.className = 'post-card';

    let tagsHtml = '';
    if (tagsRaw) {
      const tags = tagsRaw.match(/#\S+/g) || tagsRaw.split(/\s+/).filter(t => t);
      tagsHtml = `<div class="post-tags">${tags.map(t => `<span class="post-tag">${t.startsWith('#') ? t : '#'+t}</span>`).join('')}</div>`;
    }

    card.innerHTML = `
      <div class="post-platform">${platformLabel}</div>
      ${title ? `<div class="post-title">${title}</div>` : ''}
      <div class="post-body">${body.replace(/</g, '&lt;')}</div>
      ${tagsHtml}
    `;

    generatedContent.appendChild(card);
  }

  function saveToHistory(text) {
    const historyTab = document.getElementById('historyTab');
    const platform = document.getElementById('platform').value;
    const platformLabel = { xhs: 'å°çº¢ä¹¦', wechat: 'å…¬ä¼—å·', both: 'å¤šå¹³å°' }[platform];

    const typeLabel = selectedContentType === 'personality'
      ? `${selectedType1} æ€§æ ¼åˆ†æ`
      : selectedContentType === 'couple'
      ? `${selectedType1} Ã— ${selectedType2} é…å¯¹`
      : `${selectedType1} Ã— ${selectedType2} èŒåœº`;

    const now = new Date();
    const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;

    // Remove empty state if present
    const empty = historyTab.querySelector('.empty-state');
    if (empty) empty.remove();

    const item = document.createElement('div');
    item.className = 'history-item';
    item.dataset.content = text;
    item.innerHTML = `
      <div class="history-meta">
        <span class="history-type">${typeLabel} Â· ${platformLabel}</span>
        <span class="history-time">${timeStr}</span>
      </div>
      <div class="history-preview">${text.slice(0, 60)}â€¦</div>
    `;
    item.onclick = () => {
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('generatedContent').innerHTML = '';
      renderContent(text);
      document.querySelectorAll('.out-tab')[0].click();
    };

    historyTab.insertBefore(item, historyTab.firstChild);
  }

  function copyAll() {
    const content = document.getElementById('generatedContent').innerText;
    if (!content) return;
    navigator.clipboard.writeText(content).then(() => {
      const btn = document.querySelector('.action-btn');
      const orig = btn.textContent;
      btn.textContent = 'å·²å¤åˆ¶ âœ“';
      setTimeout(() => btn.textContent = orig, 2000);
    });
  }

  function clearOutput() {
    document.getElementById('generatedContent').innerHTML = '';
    document.getElementById('emptyState').style.display = 'flex';
  }

  // Init tab display
  document.getElementById('historyTab').style.display = 'none';
</script>
</body>
</html>
